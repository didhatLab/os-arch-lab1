# Документация компонента блочной сортировки CEcoLab1

## Содержание
1. [Описание компонента](#описание-компонента)
2. [Функциональность](#функциональность)
3. [Архитектура](#архитектура)
4. [Примеры использования](#примеры-использования)
5. [Сравнительный анализ](#сравнительный-анализ)
6. [Анализ производительности](#анализ-производительности)

## Описание компонента

Компонент **CEcoLab1** представляет собой реализацию алгоритма блочной сортировки (Bucket Sort) в рамках архитектуры Eco OS. Компонент предоставляет универсальный интерфейс для сортировки массивов различных числовых типов данных.

### Основные характеристики:
- **Тип**: Компонент Eco OS с интерфейсом IEcoLab1
- **Алгоритм**: Блочная сортировка (Bucket Sort) с сортировкой вставками для подблоков
- **Поддерживаемые типы**: int, long, float, double, long double
- **Сложность**: O(n + k) в среднем случае, O(n logn) в худшем случае
- **Стабильность**: Стабильный алгоритм сортировки

## Функциональность

### Интерфейс IEcoLab1

Компонент реализует интерфейс `IEcoLab1` со следующими методами:

```c
typedef struct IEcoLab1VTbl {
    // Базовые методы интерфейса
    int16_t (*QueryInterface)(IEcoLab1Ptr_t me, const UGUID* riid, voidptr_t* ppv);
    uint32_t (*AddRef)(IEcoLab1Ptr_t me);
    uint32_t (*Release)(IEcoLab1Ptr_t me);
    
    
    // Методы блочной сортировки для различных типов
    int16_t (*BucketSortInt)(IEcoLab1Ptr_t me, int* array, uint32_t length);
    int16_t (*BucketSortLong)(IEcoLab1Ptr_t me, long* array, uint32_t length);
    int16_t (*BucketSortFloat)(IEcoLab1Ptr_t me, float* array, uint32_t length);
    int16_t (*BucketSortDouble)(IEcoLab1Ptr_t me, double* array, uint32_t length);
    int16_t (*BucketSortLongDouble)(IEcoLab1Ptr_t me, long double* array, uint32_t length);
} IEcoLab1VTbl;
```

### Алгоритм блочной сортировки

Компонент реализует оптимизированную версию блочной сортировки:

1. **Определение диапазона**: Находится минимальное и максимальное значение в массиве
2. **Создание блоков**: Создается количество блоков равное длине массива
3. **Распределение элементов**: Элементы распределяются по блокам на основе нормализованного значения
4. **Сортировка блоков**: Каждый блок сортируется алгоритмом сортировки вставками
5. **Объединение**: Отсортированные блоки объединяются в итоговый массив

### Особенности реализации

- **Универсальность**: Использует макрос `DEFINE_BUCKET_SORT_FOR_TYPE` для генерации кода для разных типов
- **Управление памятью**: Использует интерфейс `IEcoMemoryAllocator1` для выделения памяти
- **Обработка ошибок**: Проверка указателей и корректная обработка ошибок выделения памяти
- **Оптимизация**: Использование буферного массива для минимизации перемещений элементов


## Примеры использования

### Пример 1: Сортировка массива целых чисел

```c
#include "IEcoLab1.h"

int main() {
    IEcoLab1* pIEcoLab1 = NULL;
    int array[] = {5, -1, 3, 3, 2, 9, 0, -4, 1};
    uint32_t length = sizeof(array) / sizeof(array[0]);
    
    // Создание компонента (код инициализации опущен)
    // ...
    
    printf("До сортировки: ");
    for (uint32_t i = 0; i < length; i++) {
        printf("%d ", array[i]);
    }
    printf("\n");
    
    // Вызов блочной сортировки
    int16_t result = pIEcoLab1->pVTbl->BucketSortInt(pIEcoLab1, array, length);
    
    if (result == ERR_ECO_SUCCESES) {
        printf("После сортировки: ");
        for (uint32_t i = 0; i < length; i++) {
            printf("%d ", array[i]);
        }
        printf("\n");
    }
    
    // Освобождение ресурсов
    pIEcoLab1->pVTbl->Release(pIEcoLab1);
    return 0;
}
```

**Результат:**
```
До сортировки: 5 -1 3 3 2 9 0 -4 1
После сортировки: -4 -1 0 1 2 3 3 5 9
```

### Пример 2: Сортировка массива чисел с плавающей точкой

```c
double array[] = {2.718, -3.0, 0.0, 123.456, 1.618, -0.001};
uint32_t length = sizeof(array) / sizeof(array[0]);

printf("До сортировки: ");
for (uint32_t i = 0; i < length; i++) {
    printf("%g ", array[i]);
}
printf("\n");

pIEcoLab1->pVTbl->BucketSortDouble(pIEcoLab1, array, length);

printf("После сортировки: ");
for (uint32_t i = 0; i < length; i++) {
    printf("%g ", array[i]);
}
printf("\n");
```

**Результат:**
```
До сортировки: 2.718 -3 0 123.456 1.618 -0.001
После сортировки: -3 -0.001 0 1.618 2.718 123.456
```

## Сравнительный анализ

### Сравнение с стандартными библиотеками C

| Характеристика | CEcoLab1 (Bucket Sort) | qsort() из stdlib.h |
|----------------|------------------------|---------------------
| **Сложность (средний случай)** | O(n + k) | O(n log n) |
| **Сложность (худший случай)** | O(nlogn) | O(nlogn) |
| **Дополнительная память** | O(n) | O(log n) |
| **Типы данных** | int, long, float, double, long double | Любые (с компаратором) |
| **Производительность на равномерно распределенных данных** | Отличная | Хорошая |
| **Производительность на частично отсортированных данных** | Хорошая | Хорошая |

